!function(n,t){"use strict";"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):n.thunks=t()}("object"==typeof window?window:this,function(){"use strict";function n(n){return"function"==typeof n}function t(t){return n(t)&&t._isThunk===p}function r(n){if(null!=n)throw n}function u(n,t){if(t=t||0,t>=n.length)return[];for(var r=n.length,u=Array(r-t);r-->t;)u[r-t]=n[r];return u}function e(n,t,r){if(r)for(var u=0,e=n.length;e>u;u++)t(n[u],u,n);else for(var l in n)n.hasOwnProperty(l)&&t(n[l],l,n)}function l(n,t,r){var u=[null,null];try{u[1]=t.apply(n,r)}catch(e){u[0]=e}return u}function o(t){return t?(n(t)?t=i(t):n(t.toThunk)?t=i(t.toThunk()):n(t.then)&&(t=i(f(t))),t):t}function i(n){return n._isThunk=p,n}function c(n){return function(r){var i,c=1,f=!1,a=y(n);if(a?i=Array(n.length):n&&"object"==typeof n&&(i={}),!i)return r(new Error("Not array or object"));var s=l(null,function(n,t){return e(n,t,a),--c||f?void 0:r(null,i)},[n,function(n,e){return f?void 0:(c++,n=o(n),t(n)?(n(function(n,t){return f?void 0:null!=n?(f=!0,r(n)):(i[e]=arguments.length>2?u(arguments,1):t,--c||r(null,i))}),void 0):(i[e]=n,--c||r(null,i)))}])[0];s&&(f=!0,r(s))}}function f(n){return function(t){return n.then(function(n){t(null,n)},t)}}function a(n){function e(t){if(n.result!==!1){n.result=!1;var e=u(arguments);if(c.debug&&c.debug.apply(null,e),null!=t){if(e=[t],c.onerror){if(c.onerror(t)!==!0)return;e=[null]}}else e[0]=null;return n.callback===r?r(t):(i.result=l(n.ctx,n.callback,e),i.callback?a(i):(null!=i.result[0]&&g(function(){i.result&&r(i.result[0])}),void 0))}}var i=n.next,c=n.scope,f=n.result;if(f!==!1){if(null!=f[0])return e(f[0]);if(f=o(f[1]),!t(f))return null==f?e(null):e(null,f);var s=l(n.ctx,f,[e])[0];return s&&e(s)}}function s(n){return n.next={ctx:n.ctx,scope:n.scope,callback:null,result:null},i(function(t){return h(n,t)})}function h(n,t){return n.callback=t||r,n.result&&a(n),s(n.next)}function d(t){function r(n){var t={ctx:this===r?null:this,scope:e,result:[null,n]};return s(t)}var e={onerror:null,debug:null};return n(t)?e.onerror=t:t&&(n(t.debug)&&(e.debug=t.debug),n(t.onerror)&&(e.onerror=t.onerror)),r.all=function(n){return r.call(this,c(n))},r.digest=function(){var n=arguments;return r.call(this,function(t){t.apply(null,n)})},r.thunkify=function(n){var t=this===r?null:this;return function(){var e=u(arguments);return r.call(t||this,function(t){e.push(t),n.apply(this,e)})}},r.delay=function(n){return r.call(this,function(t){setTimeout(t,n)})},r}var p={},v=Object.prototype.toString,y=Array.isArray||function(n){return"[object Array]"===v.call(n)},g="function"==typeof setImmediate?setImmediate:function(n){setTimeout(n,0)};return d.NAME="thunks",d.VERSION="v1.4.3",d});