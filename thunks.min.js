!function(n,t){"use strict";"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):n.thunks=t()}("object"==typeof window?window:this,function(){"use strict";function n(n){return"function"==typeof n}function t(n){return n&&n._isThunk===d}function r(n){if(null!=n)throw n}function u(n,t){if(t=t||0,t>=n.length)return[];for(var r=n.length,u=Array(r-t);r-->t;)u[r-t]=n[r];return u}function e(n,t,r){if(r)for(var u=0,e=n.length;e>u;u++)t(n[u],u,n);else for(var o in n)n.hasOwnProperty(o)&&t(n[o],o,n)}function o(n,t,r){var u=[null,null];try{u[1]=t.apply(n,r)}catch(e){u[0]=e}return u}function l(t){return t?(n(t)?t=i(t):n(t.toThunk)?t=i(t.toThunk()):n(t.then)&&(t=i(f(t))),t):t}function i(n){return n._isThunk=d,n}function c(n){return function(r){var i,c=1,f=!1,a=v(n);if(a?i=Array(n.length):n&&"object"==typeof n&&(i={}),!i)return r(new Error("Not array or object"));var s=o(null,function(n,t){return e(n,t,a),--c||f?void 0:r(null,i)},[n,function(n,e){return f?void 0:(c++,n=l(n),t(n)?(n(function(n,t){return f?void 0:null!=n?(f=!0,r(n)):(i[e]=arguments.length>2?u(arguments,1):t,--c||r(null,i))}),void 0):(i[e]=n,--c||r(null,i)))}])[0];s&&(f=!0,r(s))}}function f(n){return function(t){return n.then(function(n){t(null,n)},t)}}function a(n){function e(t){if(n.result!==!1){n.result=!1;var e=u(arguments);if(c.debug&&c.debug.apply(null,e),null!=t){if(e=[t],c.onerror){if(c.onerror(t)!==!0)return;e=[null]}}else e[0]=null;return n.callback===r?r(t):(i.result=o(n.ctx,n.callback,e),i.callback?a(i):(null!=i.result[0]&&y(function(){i.result&&r(i.result[0])}),void 0))}}var i=n.next,c=n.scope,f=n.result;if(f!==!1){if(null!=f[0])return e(f[0]);if(f=l(f[1]),!t(f))return null==f?e(null):e(null,f);var s=o(n.ctx,f,[e])[0];return s&&e(s)}}function s(n){return n.next={ctx:n.ctx,scope:n.scope,callback:null,result:null},i(function(t){return h(n,t)})}function h(n,t){return n.callback=t||r,n.result&&a(n),s(n.next)}function p(t){function r(n,t){return function(r){if(r)throw r;return v(n)&&(n=c(n)),e(n)(function(n,r){if(n)throw n;t.push(arguments.length>2?u(arguments,1):r)})}}function e(n){var t={ctx:this===e?null:this,scope:o,result:[null,n]};return s(t)}var o={onerror:null,debug:null};return n(t)?o.onerror=t:t&&(n(t.debug)&&(o.debug=t.debug),n(t.onerror)&&(o.onerror=t.onerror)),e.all=function(n){return e.call(this,c(n))},e.seq=function(){for(var n=[],t=e.call(this),u=0,o=arguments.length;o>u;u++)t=t(r(arguments[u],n));return t(function(t){if(t)throw t;return n})},e.digest=function(){var n=arguments;return e.call(this,function(t){t.apply(null,n)})},e.thunkify=function(n){var t=this===e?null:this;return function(){var r=u(arguments);return e.call(t||this,function(t){r.push(t),n.apply(this,r)})}},e.delay=function(n){return e.call(this,function(t){setTimeout(t,n)})},e}var d={},g=Object.prototype.toString,v=Array.isArray||function(n){return"[object Array]"===g.call(n)},y="function"==typeof setImmediate?setImmediate:function(n){setTimeout(n,0)};return p.NAME="thunks",p.VERSION="v1.5.0",p});